---
import { Image } from "astro:assets";
import logo from "../assets/logo.png";

const pathname = Astro.url.pathname;
const navLinks = [
    { name: "Inicio", href: "/" },
    { name: "QuiÃ©nes Somos", href: "/nosotros" },
    { name: "Servicios", href: "/servicios" },
    { name: "Blog", href: "/blog" },
];

const isActive = (href: string) => {
    if (href === "/") {
        return pathname === "/";
    }
    if (href.startsWith("#")) {
        return false; // Don't mark hash links as active
    }
    return pathname.startsWith(href);
};
---

<!-- DESKTOP NAVBAR -->
<nav
    id="desktop-nav"
    class="hidden md:block fixed top-0 left-0 right-0 z-50 transition-all duration-300 py-6 bg-transparent"
>
    <div class="container mx-auto px-6 flex justify-between items-center">
        <!-- Logo Left -->
        <a href="/" class="flex items-center gap-3 group">
            <Image
                src={logo}
                alt="Ecofamil S.A.C."
                class="h-10 w-auto transition-transform duration-300 group-hover:scale-105"
                loading="eager"
            />
        </a>

        <!-- Nav Links Right -->
        <div class="flex items-center gap-8">
            {
                navLinks.map((link) => (
                    <a
                        href={link.href}
                        class:list={[
                            "text-sm font-medium transition-colors relative group",
                            isActive(link.href)
                                ? "text-emerald-400"
                                : "text-neutral-300 hover:text-emerald-400",
                        ]}
                    >
                        {link.name}
                        <span
                            class:list={[
                                "absolute bottom-0 left-0 h-0.5 bg-emerald-400 transition-all",
                                isActive(link.href)
                                    ? "w-full"
                                    : "w-0 group-hover:w-full",
                            ]}
                        />
                    </a>
                ))
            }
        </div>
    </div>
</nav>

<!-- MOBILE BOTTOM TAB BAR -->
<nav
    class="md:hidden fixed bottom-0 left-0 right-0 z-50 bg-black/95 backdrop-blur-md border-t border-emerald-600/20"
>
    <div class="flex justify-around items-center py-2 px-2 pb-safe">
        <a
            href="/"
            class:list={[
                "flex flex-col items-center gap-1 px-3 py-2 rounded-lg transition-colors",
                isActive("/")
                    ? "text-emerald-400 bg-emerald-600/10"
                    : "text-neutral-400 hover:text-emerald-400",
            ]}
        >
            <svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
            >
                <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
            <span class="text-[10px] font-medium">Inicio</span>
        </a>

        <a
            href="/nosotros"
            class:list={[
                "flex flex-col items-center gap-1 px-3 py-2 rounded-lg transition-colors",
                isActive("/nosotros")
                    ? "text-emerald-400 bg-emerald-600/10"
                    : "text-neutral-400 hover:text-emerald-400",
            ]}
        >
            <svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
            >
                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
            <span class="text-[10px] font-medium">Nosotros</span>
        </a>

        <a
            href="/servicios"
            class:list={[
                "flex flex-col items-center gap-1 px-3 py-2 rounded-lg transition-colors",
                isActive("/servicios")
                    ? "text-emerald-400 bg-emerald-600/10"
                    : "text-neutral-400 hover:text-emerald-400",
            ]}
        >
            <svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
            >
                <rect width="7" height="7" x="3" y="3" rx="1"></rect>
                <rect width="7" height="7" x="14" y="3" rx="1"></rect>
                <rect width="7" height="7" x="14" y="14" rx="1"></rect>
                <rect width="7" height="7" x="3" y="14" rx="1"></rect>
            </svg>
            <span class="text-[10px] font-medium">Servicios</span>
        </a>

        <a
            href="/blog"
            class:list={[
                "flex flex-col items-center gap-1 px-3 py-2 rounded-lg transition-colors",
                isActive("/blog")
                    ? "text-emerald-400 bg-emerald-600/10"
                    : "text-neutral-400 hover:text-emerald-400",
            ]}
        >
            <svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
            >
                <path
                    d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"
                ></path>
            </svg>
            <span class="text-[10px] font-medium">Blog</span>
        </a>
    </div>
</nav>

<script>
    // Desktop navbar scroll effect
    const nav = document.getElementById("desktop-nav");

    function updateNavbar() {
        if (!nav) return;

        if (window.scrollY > 20) {
            nav.classList.add("bg-black/95", "backdrop-blur-md", "py-4");
            nav.classList.remove("bg-transparent", "py-6");
        } else {
            nav.classList.remove("bg-black/95", "backdrop-blur-md", "py-4");
            nav.classList.add("bg-transparent", "py-6");
        }
    }

    // Check scroll position on page load
    updateNavbar();

    // Update on scroll
    window.addEventListener("scroll", updateNavbar);
</script>

<style>
    .pb-safe {
        padding-bottom: env(safe-area-inset-bottom, 0.5rem);
    }
</style>
